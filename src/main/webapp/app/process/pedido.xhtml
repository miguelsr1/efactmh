<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Nueva factura</ui:define>
    <ui:define name="head">
        <style>
            @media (max-width: 640px) {
                .ui-datatable-reflow .ui-datatable-data td[role="gridcell"] .ui-column-title {
                    font-weight: bold !important;
                }
            }
        </style>
    </ui:define>

    <ui:define name="content">   
        <h:form prependId="false">
            <div class="grid dashboard ">
                <div class="col-12">
                    <p:accordionPanel widgetVar="basic" prependId="false"  >
                        <p:tab title="Cliente">
                            <div class="ui-fluid formgrid grid" jsf:id="dvCliente">
                                <div class="field col-12" >
                                    <p:outputLabel for="cboDte" value="Tipo de documento"/>
                                    <p:selectOneMenu id="cboDte" value="#{pedidoView.tipoDte}" required="true" requiredMessage="ES NECESARIO SELECCIONAR UN TIPO DE DTE">
                                        <f:selectItem itemLabel="SELECCIONE UN DTE" noSelectionOption="true"/>
                                        <f:selectItem itemValue="01" itemLabel="FACTURA" />
                                        <f:selectItem itemValue="03" itemLabel="CREDITO FISCAL" />
                                        <p:ajax process="@this,cboDte" />
                                    </p:selectOneMenu>
                                </div>
                                <div class="field col-12" >
                                    <p:outputLabel for="txtNumDoc" value="Número de Documento"/>
                                    <p:inputMask id="txtNumDoc" value="#{pedidoView.numeroDocumento}" onkeyup="nitDuiMask(this)"
                                                 class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" required="true">
                                        <p:ajax event="blur" listener="#{pedidoView.buscarCliente()}" update="dvCliente"/>
                                    </p:inputMask>
                                </div>
                                <div class="field col-12">
                                    <p:outputLabel for="nomRec" value="Nombre"/>
                                    <p:inputText id="nomRec" value="#{pedidoView.nombreCliente}" style="display: #{pedidoView.existeCliente ? 'block': 'none'}"
                                                 class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" required="true"/>
                                </div>
                            </div>

                            <p:commandButton value="Aceptar" styleClass="mr-2 rounded-button ui-button-info"  icon="pi pi-check" process="@this,cboDte,txtNumDoc,nomRec"  onclick="PF('basic').select(1)" />
                        </p:tab>
                        <p:tab title="Productos">
                            <p:commandButton value="Agregar" action="#{pedidoView.showDlgDetFactura()}"
                                             process="@this" icon="pi pi-plus" style="margin-bottom: 1rem"
                                             validateClient="true" styleClass="rounded-button ui-button-info">
                                <p:ajax event="dialogReturn" listener="#{pedidoView.onDetFactura}" update="tblDetPedido,lblSubTotal,lblIva,lblTotal"/>
                            </p:commandButton>
                            <p:dataTable id="tblDetPedido" widgetVar="tblDetPedido" value="#{pedidoView.pedido.detalleFacturaList}" var="item" rowIndexVar="rowId"
                                         reflow="true" size="small" tableStyle="table-layout: auto;">

                                <p:column headerText="Id">
                                    #{rowId + 1} 
                                </p:column>
                                <p:column headerText="Código">
                                    <p:outputLabel value="#{item.codigo}" />
                                </p:column>
                                <p:column headerText="Descripción">
                                    <p:outputLabel value="#{item.descripcion}" />
                                </p:column>
                                <p:column headerText="Cantidad" style="text-align: right;">
                                    <p:outputLabel value="#{item.cantidad}">
                                        <f:convertNumber pattern="#,##0"/>
                                    </p:outputLabel>
                                </p:column>
                                <p:column headerText="Precio Unit." style="text-align: right;">
                                    <p:outputLabel value="#{item.precioUni}">
                                        <f:convertNumber pattern="#,##0.00"/>
                                    </p:outputLabel>
                                </p:column>
                                <p:column headerText="Total" style="text-align: right;">
                                    <p:outputLabel value="#{item.subTotal}">
                                        <f:convertNumber pattern="#,##0.00"/>
                                    </p:outputLabel>
                                </p:column>
                            </p:dataTable>

                            <p:outputPanel id="invoice-content">
                                <div class="invoice">
                                    <div class="invoice-summary">
                                        <div class="invoice-notes">
                                            <b></b>
                                            <div>

                                            </div>
                                        </div>
                                        <div>
                                            <div class="invoice-details">
                                                <div class="invoice-label">Sub-Total</div>
                                                <div class="invoice-value">$ 
                                                    <p:outputLabel id="lblSubTotal" value="#{pedidoView.subTotal}">
                                                        <f:convertNumber pattern="#,##0.00"/>
                                                    </p:outputLabel>
                                                </div>

                                                <div class="invoice-label">IVA (13%)</div>
                                                <div class="invoice-value">$ 
                                                    <p:outputLabel id="lblIva" value="#{pedidoView.iva}">
                                                        <f:convertNumber pattern="#,##0.00"/>
                                                    </p:outputLabel>
                                                </div>

                                                <div class="invoice-label">Total</div>
                                                <div class="invoice-value">$ 
                                                    <p:outputLabel id="lblTotal" value="#{pedidoView.total}">
                                                        <f:convertNumber pattern="#,##0.00"/>
                                                    </p:outputLabel>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </p:outputPanel>

                            <p:commandButton value="Aceptar" styleClass="mr-2 rounded-button ui-button-success"  icon="pi pi-check"/>

                        </p:tab>
                        <p:tab title="Pagos">
                            <div class="ui-fluid formgrid grid" jsf:id="dvPago">
                                <div class="field col-4" >
                                    <p:outputLabel for="cboTipoPago" value="Tipo de pago"/>
                                    <p:selectOneMenu id="cboTipoPago" value="#{pedidoView.tipoPago}" required="true" requiredMessage="DEBE DE SELECCIONAR UN MÉTODO DE PAGO">
                                        <f:selectItem itemLabel="SELECCIONE" noSelectionOption="true"/>
                                        <f:selectItem itemValue="01" itemLabel="EFECTIVO" />
                                        <f:selectItem itemValue="02" itemLabel="TARJETA DEBITO" />
                                        <f:selectItem itemValue="03" itemLabel="TARJETA DEBITO" />
                                        <f:selectItem itemValue="04" itemLabel="CHEQUE" />
                                        <f:selectItem itemValue="05" itemLabel="TRANSFERENCIA-DEPOSITO BANCARIO" />
                                        <p:ajax process="@this,cboTipoPago" />
                                    </p:selectOneMenu>
                                </div>
                                <div class="field col-2" >
                                    <p:outputLabel for="txtMontoPago" value="Monto"/>
                                    <p:inputNumber id="txtMontoPago" value="#{pedidoView.detPago.monto}" inputStyle="text-align: right;"
                                                   decimalPlaces="2" decimalSeparator="." thousandSeparator="," symbol="$ "
                                                   class="w-full" required="true"/>
                                </div>
                                <div class="field col-2" >
                                    <p:outputLabel for="txtNumRef" value="Núm. de Referencia"/>
                                    <p:inputText id="txtNumRef" value="#{pedidoView.detPago.numeroReferencia}" 
                                                 class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" required="true"/>
                                </div>
                                <div class="field col-2" >
                                    <p:outputLabel for="cboPlazo" value="Plazo"/>
                                    <p:selectOneMenu id="cboPlazo" value="#{pedidoView.detPago.periodoPlazo}" required="true">
                                        <f:selectItem itemLabel="SELECCIONE" noSelectionOption="true"/>
                                        <f:selectItem itemValue="01" itemLabel="DÍAS" />
                                        <f:selectItem itemValue="02" itemLabel="MESES" />
                                        <f:selectItem itemValue="03" itemLabel="AÑOS" />
                                    </p:selectOneMenu>
                                </div>
                                <div class="field col-2">
                                    <p:outputLabel for="nomRec" value="Periodo"/>
                                    <p:inputNumber id="txtMonto" value="#{pedidoView.detPago.periodoPlazo}" inputStyle="text-align: right;"
                                                   decimalPlaces="0" thousandSeparator="," maxValue="36" 
                                                   class="w-full" required="true"/>
                                </div>
                            </div>

                            <p:commandButton value="Aceptar" styleClass="mr-2 rounded-button ui-button-info"  icon="pi pi-check" process="@this,cboDte,txtNumDoc,nomRec"  onclick="PF('basic').select(1)" />
                        </p:tab>
                    </p:accordionPanel>

                </div>
            </div>

            <p:dialog id="pnlDetalle" widgetVar="pnlDetalle" visible="false" style="max-width: 500px;" responsive="true" 
                      draggable="false" resizable="false" maximizable="false" header="Detalle Factura" modal="true">

            </p:dialog>

            <p:messages showSummary="true" showIcon="false">
                <p:autoUpdate />
            </p:messages>



            <p:dialog id="dlgResponse" widgetVar="dlgResponse" modal="true" width="800" height="600" >
                <p:panel header="RESPUESTA MH" id="pnlResponse">
                    #{viewFactura.responseMh}
                </p:panel>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>